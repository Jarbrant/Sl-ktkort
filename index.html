<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sl√§kttr√§det ‚Äì Adminpanel</title>

  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      padding: 32px 20px;
      background: #fafafa;
      color: #111;
    }

    .container {
      max-width: 880px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.6rem;
    }

    .muted {
      color: #555;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }

    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 14px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 170px;
    }

    .card h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .card p {
      margin: 0;
      color: #555;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .card a {
      margin-top: auto;
      display: inline-block;
      text-decoration: none;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px 14px;
      color: #111;
      font-weight: 600;
      background: #fff;
      width: fit-content;
    }

    .card a:hover { background: #f0f0f0; }

    /* Statusruta (f√∂rsta rutan) */
    .card.status {
      border-left: 6px solid #999;
    }
    .card.status.is-error {
      border-left-color: #b00020;
    }
    .card.status.is-ok {
      border-left-color: #1b5e20;
    }

    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #ddd;
      font-size: 0.85rem;
      color: #333;
      width: fit-content;
      background: #fff;
    }
    .pill.err { border-color: #b00020; color: #b00020; }
    .pill.ok { border-color: #1b5e20; color: #1b5e20; }

    footer {
      margin-top: 40px;
      font-size: 0.9rem;
      color: #666;
      line-height: 1.5;
    }

    code {
      background: #eee;
      padding: 2px 6px;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Sl√§kttr√§det ‚Äì Adminpanel</h1>
    <p class="muted">
      Intern kontrollpanel f√∂r att hantera tr√§d, personer, relationer och platser.<br/>
      Allt sparas lokalt i <code>localStorage</code> (GitHub Pages-l√§ge).
    </p>

    <div class="grid">
      <!-- STATUS / START (f√∂rsta rutan, nu dynamisk) -->
      <div class="card status" id="statusCard">
        <div class="pill" id="statusPill">Status</div>
        <h2 id="statusTitle">Laddar‚Ä¶</h2>
        <p id="statusText">Kontrollerar om du har n√•gra tr√§d sparade‚Ä¶</p>
        <a href="./trees.html">Skapa / v√§lj sl√§kttr√§d</a>
      </div>

      <!-- Tr√§d -->
      <div class="card">
        <h2>üå≥ Sl√§kttr√§d</h2>
        <p>
          Skapa, v√§lj och byt aktivt sl√§kttr√§d.
          Ett tr√§d √§r grunden f√∂r allt annat.
        </p>
        <a href="./trees.html">√ñppna tr√§d</a>
      </div>

      <!-- Sl√§ktkort -->
      <div class="card">
        <h2>üë§ Sl√§ktkort</h2>
        <p>
          Skapa personer i valt tr√§d.
          Namn, √•rtal, plats, anteckningar och koordinater.
        </p>
        <a href="./slaktkort.html">√ñppna sl√§ktkort</a>
      </div>

      <!-- Relationer -->
      <div class="card">
        <h2>üîó Relationer</h2>
        <p>
          Koppla personer till varandra
          (f√∂r√§lder ‚Üí barn, m.m.).
        </p>
        <a href="./create-relation.html">Skapa relation</a>
      </div>

      <!-- Karta -->
      <div class="card">
        <h2>üó∫Ô∏è Karta (platsv√§ljare)</h2>
        <p>
          V√§lj exakt plats via karta.
          Sparar lat/lon som kan anv√§ndas i sl√§ktkort.
        </p>
        <a href="./place-picker.html">√ñppna karta</a>
      </div>

      <!-- Tr√§dvy -->
      <div class="card">
        <h2>üß¨ Tr√§dvy</h2>
        <p>
          Visuell vy av sl√§kttr√§det.
          (Nu: grund / demo. Senare: riktig visualisering.)
        </p>
        <a href="./tree.html">√ñppna tr√§dvy</a>
      </div>
    </div>

    <footer>
      <p>
        Status: <strong>LocalStorage-l√§ge</strong> ‚Ä¢ Backend kan kopplas p√• senare.<br/>
        Tips: b√∂rja alltid med <strong>Sl√§kttr√§d</strong>, annars finns inget att l√§gga personer i.
      </p>
    </footer>
  </div>

  <script>
    // =========================================
    // Statusbox ‚Äì dynamisk utifr√•n localStorage
    // =========================================
    const KEY_TREES = "slakttradet_trees";
    const KEY_ACTIVE = "slakttradet_active_tree_id";

    const statusCard = document.getElementById("statusCard");
    const statusPill = document.getElementById("statusPill");
    const statusTitle = document.getElementById("statusTitle");
    const statusText = document.getElementById("statusText");

    function safeParse(raw, fallback) {
      try { return JSON.parse(raw); } catch { return fallback; }
    }

    function getTrees() {
      const raw = localStorage.getItem(KEY_TREES);
      const trees = safeParse(raw, []);
      return Array.isArray(trees) ? trees : [];
    }

    function getActiveId() {
      return localStorage.getItem(KEY_ACTIVE) || "";
    }

    function setStatus(type, title, text) {
      statusCard.classList.remove("is-error", "is-ok");
      statusPill.classList.remove("err", "ok");

      if (type === "error") {
        statusCard.classList.add("is-error");
        statusPill.classList.add("err");
        statusPill.textContent = "Beh√∂ver √•tg√§rd";
      } else if (type === "ok") {
        statusCard.classList.add("is-ok");
        statusPill.classList.add("ok");
        statusPill.textContent = "Redo";
      } else {
        statusPill.textContent = "Status";
      }

      statusTitle.textContent = title;
      statusText.textContent = text;
    }

    function refreshStatus() {
      const trees = getTrees();
      const activeId = getActiveId();
      const active = trees.find(t => t && t.id === activeId);

      if (trees.length === 0) {
        setStatus(
          "error",
          "üö© Inga tr√§d sparade",
          "G√• till 'Skapa/V√§lj tr√§d' och skapa ett tr√§d f√∂rst. Det √§r grunden f√∂r personer, relationer och visning."
        );
        return;
      }

      if (!active) {
        setStatus(
          "error",
          "‚ö†Ô∏è Inget aktivt tr√§d valt",
          "Du har tr√§d sparade, men inget √§r aktivt. G√• till 'Skapa/V√§lj tr√§d' och v√§lj ett aktivt tr√§d."
        );
        return;
      }

      setStatus(
        "ok",
        "‚úÖ Aktivt tr√§d √§r valt",
        `Aktivt tr√§d: ${String(active.name || active.id)}. Du kan nu skapa sl√§ktkort och relationer.`
      );
    }

    refreshStatus();
  </script>
</body>
</html>
