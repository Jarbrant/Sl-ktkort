<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karta – Släktträd</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; }
    header { padding: 16px 20px; border-bottom: 1px solid #ddd; }
    h1 { margin: 0 0 6px; font-size: 1.2rem; }
    .muted { color:#555; margin:0; }

    .wrap { padding: 12px 20px; }
    .msg { margin-top: 10px; }
    .ok { font-weight: 800; }
    .error { color:#b00020; font-weight: 800; }

    #map {
      height: 70vh;
      margin-top: 14px;
      border: 1px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
    }

    .coordsBox {
      margin-top: 10px;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fafafa;
      max-width: 520px;
    }
    .coordsBox code { background:#f0f0f0; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>

<header>
  <h1>Släktträd – karta</h1>
  <p class="muted">Klicka för att placera en prick. Dra och släpp pricken för att välja lat/lon.</p>
</header>

<div class="wrap">
  <div id="msg" class="msg muted" aria-live="polite"></div>

  <div class="coordsBox">
    Vald punkt: <code id="coordsOut">—</code>
  </div>

  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<script>
  const msg = document.getElementById("msg");
  const coordsOut = document.getElementById("coordsOut");

  function setMsg(type, text) {
    msg.className = "msg " + (type === "error" ? "error" : type === "ok" ? "ok" : "muted");
    msg.textContent = text;
  }

  function setCoordsText(lat, lon) {
    coordsOut.textContent = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
  }

  // Initiera karta (Sverige)
  const map = L.map("map").setView([62.0, 15.0], 5);

  L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap contributors"
  }).addTo(map);

  // Marker som kan dras och släppas
  let pickMarker = null;

  function ensurePickMarker(latlng) {
    if (!pickMarker) {
      pickMarker = L.marker(latlng, { draggable: true }).addTo(map);
      pickMarker.bindPopup("Vald punkt (dra och släpp)").openPopup();

      pickMarker.on("dragend", () => {
        const ll = pickMarker.getLatLng();
        setCoordsText(ll.lat, ll.lng);
        setMsg("ok", "Punkt uppdaterad (drag & drop).");
      });
    } else {
      pickMarker.setLatLng(latlng);
    }

    const ll = pickMarker.getLatLng();
    setCoordsText(ll.lat, ll.lng);
  }

  // Klick i kartan = sätt punkt
  map.on("click", (e) => {
    ensurePickMarker(e.latlng);
    setMsg("ok", "Punkt satt. Du kan nu dra och släppa pricken.");
  });

  setMsg("", "Klicka i kartan för att placera pricken.");
</script>

</body>
</html>
